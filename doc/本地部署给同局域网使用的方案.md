# 本地服务给同局域网使用的方案

> 2026-01-30

---

## 方案：Windows 端口转发（推荐）

让其他电脑通过 Windows 电脑的 IP 访问 WSL 中的服务。

### 步骤 1：在 Windows PowerShell（管理员）中运行

```powershell
# 转发后端 8888 端口
netsh interface portproxy add v4tov4 listenport=8888 listenaddress=0.0.0.0 connectport=8888 connectaddress=localhost

# 转发前端 3000 端口
netsh interface portproxy add v4tov4 listenport=3000 listenaddress=0.0.0.0 connectport=3000 connectaddress=localhost

# 查看已设置的转发规则
netsh interface portproxy show all
```

### 步骤 2：启动 WSL 中的服务

```bash
# 后端
source venv/bin/activate
uvicorn app.main:app --host 0.0.0.0 --port 8888

# 前端（新终端）
pnpm dev
```

### 步骤 3：局域网访问

**获取 Windows 电脑 IP**：
```powershell
ipconfig
```
找 "IPv4 地址" 或 "以太网适配器 虚拟机器" 的地址，如 `192.168.1.100`  

**访问地址**：
- 前端：`http://192.168.1.100:3000`
- 后端 API：`http://192.168.1.100:8888`
- Webhook：`http://192.168.1.100:8888/api/v1/webhook/confirm`
- API 文档：`http://192.168.1.100:8888/docs`

---

## 其他方案

### 方案 2：Windows 上直接运行后端

绕过 WSL，直接在 Windows 上运行：

```bash
# 在 Windows CMD/PowerShell 中
cd C:\path\to\RPA-workbench\backend
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 8888
```

### 方案 3：ngrok（需要注册）

```bash
# 安装 ngrok
winget install ngrok

# 暴露端口
ngrok http 8888
```

然后得到公网地址分享给他人。

---

## 故障排查

| 问题 | 解决方案 |
|------|----------|
| 端口转发不生效 | 确保 Windows 防火墙允许端口 8888 和 3000 |
| WSL IP 变化 | 使用端口转发后不受影响 |
| 前端 API 请求失败 | 确认前端和后端都通过端口转发暴露 |
| Webhook 无法访问 | 确认外网可以访问 Windows 的 8888 端口 |

---

## Windows 防火墙设置

如果端口被防火墙阻止：

```powershell
# 允许端口
netsh advfirewall firewall add rule name="RPA Backend 8888" dir=in action=allow protocol=TCP localport=8888
netsh advfirewall firewall add rule name="RPA Frontend 3000" dir=in action=allow protocol=TCP localport=3000
```


1. 启动后端服务
2. 转发 8888 端口 到 0.0.0.0
3. 使用win的ip:8888 给其他电脑访问调用后端端口，实现交互
