# 仪表盘数据优化方案

> 2026-02-02

---

## 一、当前仪表盘数据概览

### 1.1 数据卡片（4个）

| 卡片 | 主数值 | 辅助信息 | 数据来源 |
|------|--------|----------|----------|
| 总账号数 | 账号总数 | 运行中数量 | `stats.accounts` |
| 活跃任务 | pending + running | 成功率 | `stats.tasks` + `performance.completionRate` |
| 执行统计 | completed / failed | 成功率 | `stats.tasks` + `stats.execution_logs` |
| 平均执行时间 | 平均时长 | 最近7天 | `performance.avgDuration` |

### 1.2 图表区域（3个）

| 图表 | 类型 | 数据 |
|------|------|------|
| 性能趋势 | AreaChart | 每日执行次数 |
| 任务执行时间排行 | 表格 | 总时长、执行次数 |
| 任务状态分布 | PieChart | pending / running |

---

## 二、发现的问题

### 2.1 数据重复

| 问题 | 详情 |
|------|------|
| **成功率重复** | 活跃任务卡片和执行统计卡片都显示成功率，数值来源相同（全部历史数据），仅舍入精度不同 |

### 2.2 时间范围标注不一致

| 卡片 | 当前标注 | 实际数据 | 问题 |
|------|----------|----------|------|
| 活跃任务 | 无标注 | 全部历史 | ❌ 用户无法知道数据范围 |
| 平均执行时间 | "最近7天" | 全部历史 | ❌ 标注与实际不符 |

### 2.3 数据口径不清晰

| 问题 | 详情 |
|------|------|
| **活跃任务定义** | pending + running 之和，但标注"成功率"容易混淆 |
| **执行统计** | completed / failed 是执行结果，不是任务状态 |

### 2.4 任务状态分布

| 问题 | 详情 |
|------|------|
| **显示不完整** | 只显示 pending/running（任务表状态），用户期望看到 completed/failed |
| **设计冲突** | 任务本身只有 pending/running 两种状态，completed/failed 是执行结果 |

---
用户补充：任务状态分布 就是 只显示 pending/running 数据源就是 “任务控制” 页的任务状态



## 三、优化方案

### 3.1 方案：精简卡片，突出核心指标

#### 调整后的卡片布局

| 卡片 | 主数值 | 辅助信息 | 说明 |
|------|--------|----------|------|
| **总账号数** | 账号总数 | 运行中数量 | 保持不变 |
| **任务概况** | 待启动 / 运行中 | - | 拆分显示，不再显示成功率 |
| **执行统计** | 成功 / 失败 | 成功率 | 核心指标，唯一成功率来源 |
| **平均耗时** | 平均时长 | 全部历史 | 修正时间标注 |

#### 成功率只显示一次

- 在"执行统计"卡片中显示成功率
- 移除"活跃任务"卡片中的成功率

### 3.2 修正时间标注

| 卡片 | 修改前 | 修改后 |
|------|--------|--------|
| 活跃任务 | 无标注 | "全部历史" |
| 平均执行时间 | "最近7天" | "全部历史" |

### 3.3 任务状态分布优化

**选项 A**：保持现状（只显示 pending/running）
- 理由：符合数据模型（任务表状态）
- 问题：用户期望看到 completed/failed

**选项 B**：改为"执行结果分布"
- 显示 completed / failed 数量
- 数据来源：`stats.execution_logs.by_status`
- 更符合用户期望

**推荐**：选项 B

### 3.4 执行排行优化

| 优化项 | 当前 | 优化后 |
|--------|------|--------|
| 时间单位 | 分钟 | 分钟 / 小时（自动转换） |
| 趋势指示 | 无 | 添加环比变化箭头 |

---

## 四、具体修改

### 4.1 前端修改（Dashboard.tsx）

```typescript
// 卡片1: 总账号数 - 保持不变
// 卡片2: 任务概况 - 移除成功率
{
  /* 移除成功率显示 */
}

// 卡片3: 执行统计 - 保持不变（成功率唯一来源）
{
  /* 保留 success_rate */
}

// 卡片4: 平均耗时 - 修正标注
<span className="font-normal">全部历史</span>

// 任务状态分布 - 改为执行结果分布
const statusData = stats ? [
  { name: '成功', value: stats.execution_logs.by_status.completed, color: '#10b981' },
  { name: '失败', value: stats.execution_logs.by_status.failed, color: '#ef4444' },
].filter(item => item.value > 0) : [];
```

### 4.2 后端修改（可选）

如需支持"最近7天"统计数据，需新增 API：
```
GET /api/v1/dashboard/stats?days=7
```

---

## 五、优先级

| 优先级 | 优化项 | 复杂度 |
|--------|--------|--------|
| P0 | 移除重复的成功率显示 | 低 |
| P0 | 修正时间标注为"全部历史" | 低 |
| P1 | 任务状态分布改为执行结果分布 | 低 |
| P2 | 执行排行支持小时/分钟自动转换 | 低 |
| P2 | 新增"最近7天"统计数据 API | 中 |

---

## 六、效果预览

### 优化前

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 总账号数     │ 活跃任务     │ 执行统计     │ 平均执行时间 │
│ 4           │ 2           │ 23 / 3      │ 15分钟       │
│ 运行中: 0   │ ↗ 88% 成功   │ ✓ 88.5%成功  │ 最近7天      │
└─────────────┴─────────────┴─────────────┴─────────────┘
      ↑                ↑                ↑
   无重复           重复成功率       标注不符
```

### 优化后

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 总账号数     │ 待启动 / 运行 │ 执行统计     │ 平均耗时     │
│ 4           │ 2           │ 23 / 3      │ 15分钟       │
│ 运行中: 0   │ -           │ ✓ 88.5%成功  │ 全部历史     │
└─────────────┴─────────────┴─────────────┴─────────────┘
                      ↑
                   无重复
```

---

## 七、待确认

1. 是否接受将"任务状态分布"改为"执行结果分布"？
2. 是否需要新增"最近7天"统计数据？
3. 执行排行是否需要添加趋势指示？
