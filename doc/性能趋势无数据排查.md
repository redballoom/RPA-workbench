# 性能趋势数据为空问题排查

> 发现日期: 2026-01-30

---

## 问题描述

性能趋势图表没有数据显示，但数据库中有执行记录。

## 问题分析

### 数据库数据
```
总记录数: 5
状态分布: completed: 2, failed: 3
时间范围: 2026-01-30 11:03:51 ~ 2026-01-30 11:03:51
```

### API 返回
```json
{
  "dailyStats": [],
  "totalExecutions": 0
}
```

### 根本原因

**时区不匹配问题**:

| 组件 | 时间类型 | 说明 |
|------|----------|------|
| 数据库 | 北京时间 | 直接存储传入的时间（+8:00） |
| API | UTC 时间 | 使用 `datetime.utcnow()` |

**查询范围对比**:
```
API 查询: 2026-01-23 04:15 ~ 2026-01-30 04:15 (UTC)
数据库时间: 2026-01-30 11:03:51 (北京时间 = UTC 2026-01-30 03:03:51)
                                                        ↑
                                            数据库时间落在查询范围外！
```

---

## 解决方案

### 方案：移除时间范围限制（查询全部历史）

由于排行榜已改为"全部历史数据"，性能趋势也应当一致。

**修改文件**:
1. `backend/app/services/dashboard_service.py`
2. `backend/app/repositories/log_repository.py`

**修改内容**:
- `dashboard_service.py`: 传递 `None` 作为时间参数
- `log_repository.py`: 动态构建 WHERE 条件

---

## 验证步骤

```bash
# 测试 API
curl http://localhost:8000/api/v1/dashboard/performance
```

**预期响应**:
```json
{
  "dailyStats": [{"date": "2026-01-30", "totalExecutions": 5, "completed": 2, "failed": 3}],
  "totalExecutions": 5
}
```
